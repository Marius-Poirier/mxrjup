<div class="admin-container">
    <header>
        <h1>Admin Dashboard</h1>
        <button (click)="logout()">Logout</button>
    </header>

    <nav class="tabs">
        <button [class.active]="activeTab === 'timeline'" (click)="setTab('timeline')">Timeline</button>
        <button [class.active]="activeTab === 'history'" (click)="setTab('history')">History</button>
        <button [class.active]="activeTab === 'reviews'" (click)="setTab('reviews')">Reviews</button>
        <button [class.active]="activeTab === 'media'" (click)="setTab('media')">Media</button>
        <button [class.active]="activeTab === 'cool_stuff'" (click)="setTab('cool_stuff')">Cool Stuff</button>
        <button [class.active]="activeTab === 'credits'" (click)="setTab('credits')">Credits</button>
    </nav>

    <div class="content">
        <!-- Generic List View -->
        <div class="list-section">
            <h3>Existing Items</h3>
            <ul>
                <li *ngFor="let item of currentData; let i = index">
                    <span class="item-summary">{{ getItemSummary(item) }}</span>
                    <div class="actions">
                        <button (click)="editItem(i)">Edit</button>
                        <button (click)="deleteItem(i)">Delete</button>
                    </div>
                </li>
            </ul>
            <p *ngIf="currentData.length === 0">No items found.</p>
        </div>

        <hr>

        <!-- Dynamic Form based on Tab -->
        <div class="form-section">
            <h3>{{ editingIndex === -1 ? 'Add New' : 'Edit' }} Item</h3>

            <!-- Timeline (Now Labeled History) Form -->
            <div *ngIf="activeTab === 'timeline'" class="form-grid">
                <label>Album Title: <input [(ngModel)]="currentItem.title" placeholder="Ex: The Life of Pablo"></label>
                <label>Date: <input type="date" [(ngModel)]="currentItem.date"></label>
                <label>Cover Image:
                    <input type="file" (change)="uploadFile($event, 'cover')">
                    <div *ngIf="currentItem.cover" class="preview"><img [src]="currentItem.cover"></div>
                </label>
            </div>

            <!-- History (Now Labeled Timeline) Form -->
            <div *ngIf="activeTab === 'history'" class="form-grid">
                <label>Log Text: <textarea [(ngModel)]="currentItem.text"
                        placeholder="What are you listening to?"></textarea></label>
                <label>Date/Time: <input type="datetime-local" [(ngModel)]="currentItem.date"></label>
            </div>

            <!-- Reviews Form -->
            <div *ngIf="activeTab === 'reviews'" class="form-grid">
                <label>Artist: <input [(ngModel)]="currentItem.artist"></label>
                <label>Album: <input [(ngModel)]="currentItem.album"></label>
                <label>Genre: <input [(ngModel)]="currentItem.genre"></label>
                <label>Cover:
                    <input type="file" (change)="uploadFile($event, 'cover')">
                    <div *ngIf="currentItem.cover" class="preview"><img [src]="currentItem.cover"></div>
                </label>
                <label>Review Author: <input [(ngModel)]="currentItem.author"></label>
                <label>Date: <input type="date" [(ngModel)]="currentItem.date"></label>
                <label>Score (Optional): <input [(ngModel)]="currentItem.score" placeholder="Ex: 8.5"></label>

                <label>Summary (List view text):
                    <textarea [(ngModel)]="currentItem.text" rows="3"></textarea>
                </label>

                <label>Full Content (HTML allowed):
                    <textarea [(ngModel)]="currentItem.content" rows="10"
                        placeholder="<p>Review content...</p>"></textarea>
                </label>

                <fieldset>
                    <legend>Sound Extracts</legend>
                    <div class="extract-inputs">
                        <input [(ngModel)]="newExtract.title" placeholder="Track Title">
                        <input type="file" (change)="uploadFile($event, 'url', newExtract)">
                        <span *ngIf="newExtract.url">File Loaded</span>
                        <button (click)="addExtract()">Add Extract</button>
                    </div>
                    <ul class="extract-list">
                        <li *ngFor="let ex of currentItem.extracts; let i = index">
                            {{ex.title}} <a [href]="ex.url" target="_blank">[Link]</a>
                            <button (click)="removeExtract(i)">Remove</button>
                        </li>
                    </ul>
                </fieldset>
            </div>

            <!-- Media Form -->
            <div *ngIf="activeTab === 'media'" class="form-grid">
                <label>Title: <input [(ngModel)]="currentItem.title"></label>
                <label>Type:
                    <select [(ngModel)]="currentItem.type">
                        <option value="image">Image</option>
                        <option value="video">Video</option>
                        <option value="audio">Audio</option>
                    </select>
                </label>
                <label>Main File:
                    <input type="file" (change)="uploadFile($event, 'url')">
                    <div *ngIf="currentItem.url">File: {{currentItem.url}}</div>
                </label>
                <label *ngIf="currentItem.type !== 'image'">Thumbnail (Optional):
                    <input type="file" (change)="uploadFile($event, 'thumbnail')">
                    <div *ngIf="currentItem.thumbnail" class="preview"><img [src]="currentItem.thumbnail"></div>
                </label>
            </div>

            <!-- Cool Stuff Form -->
            <div *ngIf="activeTab === 'cool_stuff'" class="form-grid">
                <label>Title: <input [(ngModel)]="currentItem.title"></label>
                <label>Type:
                    <select [(ngModel)]="currentItem.type">
                        <option value="BOOK">BOOK</option>
                        <option value="PRODUCT">PRODUCT</option>
                        <option value="ARTICLE">ARTICLE</option>
                        <option value="MUSIC">MUSIC</option>
                        <option value="IMAGE">IMAGE</option>
                    </select>
                </label>
                <label>Subtitle / Author: <input [(ngModel)]="currentItem.subtitle"></label>
                <label>Link: <input [(ngModel)]="currentItem.link"></label>
                <label>Image:
                    <input type="file" (change)="uploadFile($event, 'image')">
                    <div *ngIf="currentItem.image" class="preview"><img [src]="currentItem.image"></div>
                </label>

            </div>

        </div>

        <!-- Credits Form -->
        <div *ngIf="activeTab === 'credits'" class="form-grid">
            <label>Art Name: <input [(ngModel)]="currentItem.artName" placeholder="Ex: Decor 1"></label>
            <label>Artist Name: <input [(ngModel)]="currentItem.artistName" placeholder="Ex: John Doe"></label>
        </div>

        <div class="form-actions">
            <span *ngIf="uploadStatus" class="upload-status" [class.success]="uploadStatus === 'File Ready'">{{
                uploadStatus }}</span>
            <button class="save-btn" (click)="saveItem()" [disabled]="isUploading">Save Item</button>
            <button class="cancel-btn" (click)="resetForm()">Cancel</button>
        </div>
    </div>
</div>